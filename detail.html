<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Portfolio Details</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: auto;
      background: #f4f4f4;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }
    a{
      text-decoration: none;
      color: white;
    }
    form {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .form-group {
      margin-bottom: 15px;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }
    .project-group {
      border: 1px solid #ccc;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 6px;
      background: #f9f9f9;
    }
    button {
      background: #007bff;
      color: white;
      padding: 10px 20px;
      border: none;
      font-size: 1rem;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    .error {
      color: red;
      font-size: 0.8rem;
      margin-top: 5px;
    }
  </style>
</head>
<body>
<button type="button" id="home-btn" style="position: relative;left: 85%; background:#007bff;">
  <a href="index.html">Home</a>
</button>
  <h1>Enter Portfolio Details</h1>
  
  <form id="portfolioForm">
    <div class="form-group">
      <label for="name">Full Name</label>
      <input type="text" id="name" required />
      <div class="error" id="name-error"></div>
    </div>

    <div class="form-group">
      <label for="title">Professional Title</label>
      <input type="text" id="title" placeholder="e.g., Web Developer" required />
      <div class="error" id="title-error"></div>
    </div>
   
  <div class="form-group">
      <label for="userPhoto">Upload Your Photo</label>
      <input type="file" id="userPhoto" accept="image/*">
      <div class="error" id="photo-error"></div>
    </div>

    <div class="form-group">
      <label for="bio">Short Bio</label>
      <textarea id="bio" rows="3" placeholder="Write a short professional bio..." required></textarea>
      <div class="error" id="bio-error"></div>
    </div>

    <div class="form-group">
      <label for="skills">Skills (comma separated)</label>
      <input type="text" id="skills" placeholder="e.g., HTML, CSS, JavaScript" required />
      <div class="error" id="skills-error"></div>
    </div>

    <div class="form-group">
      <label for="about">About Section</label>
      <textarea id="about" rows="5" placeholder="Write about yourself..." required></textarea>
      <div class="error" id="about-error"></div>
    </div>

    <div class="form-group">
      <label for="email">Email</label>
      <input type="email" id="email" required />
      <div class="error" id="email-error"></div>
    </div>

    <div class="form-group">
      <label for="phone">Phone</label>
      <input type="text" id="phone" />
    </div>

    <div class="form-group">
      <label for="linkedin">LinkedIn URL</label>
      <input type="url" id="linkedin" />
    </div>

    <div class="form-group">
      <label for="github">GitHub URL</label>
      <input type="url" id="github" />
    </div>

    <hr/>
    <h3>Projects</h3>
    <div id="projects-container"></div>
    <button type="button" onclick="addProject()">+ Add Project</button>

    <br/><br/>
    <button type="submit" id="submit-btn">Generate Portfolio</button>
  </form>

  <script>
  const form = document.getElementById("portfolioForm");
  const projectsContainer = document.getElementById("projects-container");
  const submitBtn = document.getElementById("submit-btn");
  let projectCount = 0;

  let uploadedPhotoBase64 = "";

  //  Convert photo to base64 and save into variable (outside submit handler)
  const photoInput = document.getElementById("userPhoto");
  photoInput.addEventListener("change", function (e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onloadend = function () {
      uploadedPhotoBase64 = reader.result; // Set in memory
      console.log("✅ Photo saved to memory");
    };
    reader.readAsDataURL(file);
  });

  const validateField = (fieldId, errorId) => {
    const field = document.getElementById(fieldId);
    const error = document.getElementById(errorId);
    if (!field.value.trim()) {
      error.textContent = "This field is required";
      return false;
    }
    error.textContent = "";
    return true;
  };

  const validateEmail = () => {
    const email = document.getElementById("email");
    const error = document.getElementById("email-error");
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!re.test(email.value)) {
      error.textContent = "Please enter a valid email";
      return false;
    }
    return true;
  };

  function addProject() {
    const div = document.createElement("div");
    div.className = "project-group";
    div.innerHTML = `
      <div class="form-group">
        <label>Project Title</label>
        <input type="text" class="project-title" required />
        <div class="error project-title-error"></div>
      </div>
      <div class="form-group">
        <label>Project Description</label>
        <textarea class="project-description" rows="3" required></textarea>
        <div class="error project-description-error"></div>
      </div>
      <div class="form-group">
        <label>Project Link</label>
        <input type="url" class="project-link" placeholder="https://..." />
      </div>
      <div class="form-group">
        <label>Project Image</label>
        <input type="file" class="project-image" accept="image/*" />
      </div>
      <button type="button" onclick="this.parentNode.remove()" style="background: #dc3545;">Remove Project</button>
    `;
    projectsContainer.appendChild(div);
  }

  function toBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = () => resolve(reader.result);
      reader.onerror = error => reject(error);
    });
  }

  const validateProjects = () => {
    const projectGroups = document.querySelectorAll(".project-group");
    let isValid = true;
    projectGroups.forEach(group => {
      const title = group.querySelector(".project-title");
      const description = group.querySelector(".project-description");
      const titleError = group.querySelector(".project-title-error");
      const descError = group.querySelector(".project-description-error");

      if (!title.value.trim()) {
        titleError.textContent = "Project title is required";
        isValid = false;
      } else {
        titleError.textContent = "";
      }

      if (!description.value.trim()) {
        descError.textContent = "Project description is required";
        isValid = false;
      } else {
        descError.textContent = "";
      }
    });
    return isValid;
  };

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const isNameValid = validateField("name", "name-error");
    const isTitleValid = validateField("title", "title-error");
    const isBioValid = validateField("bio", "bio-error");
    const isSkillsValid = validateField("skills", "skills-error");
    const isAboutValid = validateField("about", "about-error");
    const isEmailValid = validateField("email", "email-error") && validateEmail();
    const areProjectsValid = validateProjects();

    if (!isNameValid || !isTitleValid || !isBioValid || !isSkillsValid || !isAboutValid || !isEmailValid || !areProjectsValid) {
      return;
    }

    submitBtn.disabled = true;
    submitBtn.textContent = "Processing...";

    const formData = {
      name: document.getElementById("name").value.trim(),
      title: document.getElementById("title").value.trim(),
      bio: document.getElementById("bio").value.trim(),
      skills: document.getElementById("skills").value.trim().split(",").map(s => s.trim()),
      about: document.getElementById("about").value.trim(),
      email: document.getElementById("email").value.trim(),
      phone: document.getElementById("phone").value.trim(),
      linkedin: document.getElementById("linkedin").value.trim(),
      github: document.getElementById("github").value.trim(),
      photo: uploadedPhotoBase64, // ✅ Save photo here!
      projects: []
    };

    const projectGroups = document.querySelectorAll(".project-group");
    for (const group of projectGroups) {
      const title = group.querySelector(".project-title").value.trim();
      const description = group.querySelector(".project-description").value.trim();
      const link = group.querySelector(".project-link").value.trim();
      const imageFile = group.querySelector(".project-image").files[0];

      let imageBase64 = "";
      if (imageFile) {
        try {
          imageBase64 = await toBase64(imageFile);
        } catch (error) {
          console.error("Error processing project image:", error);
        }
      }

      formData.projects.push({
        title,
        description,
        link,
        image: imageBase64
      });
    }

    localStorage.setItem("formData", JSON.stringify(formData));
    const selectedTemplate = localStorage.getItem("selectedTemplate") || "minimal";
    window.location.href = `${selectedTemplate}.html`;
  });

  addProject(); // Load initial project input
</script>

</body>
</html>